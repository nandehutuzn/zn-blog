<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP 网络协议 | 张宁-个人博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="前端、C#、算法、生活......">
    
    <link rel="preload" href="/assets/css/0.styles.65a9d785.css" as="style"><link rel="preload" href="/assets/js/app.73819cc8.js" as="script"><link rel="preload" href="/assets/js/2.1d157987.js" as="script"><link rel="preload" href="/assets/js/38.a7b0b0ff.js" as="script"><link rel="prefetch" href="/assets/js/10.f7aa8c22.js"><link rel="prefetch" href="/assets/js/11.68be72b2.js"><link rel="prefetch" href="/assets/js/12.2f13c77f.js"><link rel="prefetch" href="/assets/js/13.60fe103f.js"><link rel="prefetch" href="/assets/js/14.c9ded3f6.js"><link rel="prefetch" href="/assets/js/15.c3556b29.js"><link rel="prefetch" href="/assets/js/16.8c54a7e1.js"><link rel="prefetch" href="/assets/js/17.0b820cc5.js"><link rel="prefetch" href="/assets/js/18.64ee49bc.js"><link rel="prefetch" href="/assets/js/19.f28019a2.js"><link rel="prefetch" href="/assets/js/20.d3231e89.js"><link rel="prefetch" href="/assets/js/21.4cef60ce.js"><link rel="prefetch" href="/assets/js/22.670c4a5a.js"><link rel="prefetch" href="/assets/js/23.ab4be979.js"><link rel="prefetch" href="/assets/js/24.59a6b942.js"><link rel="prefetch" href="/assets/js/25.483117e0.js"><link rel="prefetch" href="/assets/js/26.671a06b1.js"><link rel="prefetch" href="/assets/js/27.c3fc8241.js"><link rel="prefetch" href="/assets/js/28.4a9d0045.js"><link rel="prefetch" href="/assets/js/29.59e1c35b.js"><link rel="prefetch" href="/assets/js/3.4103b7e1.js"><link rel="prefetch" href="/assets/js/30.07b4c4e3.js"><link rel="prefetch" href="/assets/js/31.80ddf6b7.js"><link rel="prefetch" href="/assets/js/32.5ac36d6f.js"><link rel="prefetch" href="/assets/js/33.f906ce7a.js"><link rel="prefetch" href="/assets/js/34.ebd39fbe.js"><link rel="prefetch" href="/assets/js/35.cfdae827.js"><link rel="prefetch" href="/assets/js/36.1655e37e.js"><link rel="prefetch" href="/assets/js/37.625c187d.js"><link rel="prefetch" href="/assets/js/39.40e33dba.js"><link rel="prefetch" href="/assets/js/4.c98340cf.js"><link rel="prefetch" href="/assets/js/40.5fc10627.js"><link rel="prefetch" href="/assets/js/41.fe32f84d.js"><link rel="prefetch" href="/assets/js/42.87fa8e79.js"><link rel="prefetch" href="/assets/js/43.55e09ac6.js"><link rel="prefetch" href="/assets/js/44.70e7a5c0.js"><link rel="prefetch" href="/assets/js/45.3259b240.js"><link rel="prefetch" href="/assets/js/46.1e92f698.js"><link rel="prefetch" href="/assets/js/47.329bf0e4.js"><link rel="prefetch" href="/assets/js/5.ab149363.js"><link rel="prefetch" href="/assets/js/6.dfa8bf1a.js"><link rel="prefetch" href="/assets/js/7.97018498.js"><link rel="prefetch" href="/assets/js/8.6a48e8a0.js"><link rel="prefetch" href="/assets/js/9.9443a568.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65a9d785.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">张宁-个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/frontend/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/dotnet/" class="nav-link">
  .NET
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://github.com/nandehutuzn/zn-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/frontend/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/dotnet/" class="nav-link">
  .NET
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://github.com/nandehutuzn/zn-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>HTTP 网络协议</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/http.html#http-协议" class="sidebar-link">HTTP 协议</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/frontend/http.html#原理" class="sidebar-link">原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/http.html#http-协议工作流程" class="sidebar-link">HTTP 协议工作流程</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-请求信息和响应信息" class="sidebar-link">HTTP 请求信息和响应信息</a></li></ul></li><li><a href="/frontend/http.html#http-进阶" class="sidebar-link">HTTP 进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/http.html#防盗链" class="sidebar-link">防盗链</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#缓存详解" class="sidebar-link">缓存详解</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-内容压缩" class="sidebar-link">HTTP 内容压缩</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-cookie" class="sidebar-link">HTTP Cookie</a></li></ul></li><li><a href="/frontend/http.html#http-各版本特性" class="sidebar-link">HTTP 各版本特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/http.html#http-0-9" class="sidebar-link">HTTP/0.9</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-1-0" class="sidebar-link">HTTP/1.0</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-1-1" class="sidebar-link">HTTP/1.1</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-2-0" class="sidebar-link">HTTP/2.0</a></li><li class="sidebar-sub-header"><a href="/frontend/http.html#http-3-0" class="sidebar-link">HTTP/3.0</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http-网络协议"><a href="#http-网络协议" class="header-anchor">#</a> HTTP 网络协议</h1> <hr> <p><em>2020/10/26</em></p> <h2 id="http-协议"><a href="#http-协议" class="header-anchor">#</a> HTTP 协议</h2> <div class="custom-block tip"><p>HTTP 是网络应用层的一个协议，重要性不言而喻，无论是 webservice 还是 rest 做大型架构，都离不开HTTP协议的认识，甚至可以简化的说：</p> <ul><li>webservice = HTTP协议 + XML</li> <li>Rest = HTTP协议 + json</li> <li>各种 <strong>API</strong> 也一般是用 HTTP + XML/json来实现的</li></ul></div> <h2 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h2> <div class="custom-block tip"><p>什么是协议，一式双份/多份，双方都遵从的一个规范，这个规范就可以成为协议，计算机之所以能全世界互通，协议功不可没。如FTP协议、SMTP协议、HTTP协议等</p></div> <h3 id="http-协议工作流程"><a href="#http-协议工作流程" class="header-anchor">#</a> HTTP 协议工作流程</h3> <div class="custom-block tip"><p>首先客户端(如浏览器)和服务端是相互独立的，客户端要向服务端发请求时，必须先建立连接，连接可理解为网络上的虚拟电路，连接建立之后客户端发送请求，然后服务端沿着连接，返回响应信息。客户端接收响应，解释出图片或文字，然后断开连接，一次 HTTP 请求结束。</p> <p>下面看看一次请求中的详细过程</p></div> <h3 id="http-请求信息和响应信息"><a href="#http-请求信息和响应信息" class="header-anchor">#</a> HTTP 请求信息和响应信息</h3> <h4 id="请求信息"><a href="#请求信息" class="header-anchor">#</a> 请求信息</h4> <div class="custom-block tip"><ul><li>请求行 （GET /api/home.html HTTP/1.1）
<ul><li>请求方法（GET、POST、PUT、DELETE、HEAD等）
<ul><li>这些请求方法虽是HTTP协议里规定的，但服务器未必允许或支持这些方法</li> <li>HEAD 和 GET 区别：HEAD 不返回主体信息，而 GET 请求会返回主体信息，当不需要服务器返回的主体信息时，可用 HEAD 方法</li></ul></li> <li>请求路径</li> <li>所用协议</li></ul></li> <li>请求头信息（头信息结束后有一个空行，由这个空行来做区分，即使没有主体信息，空行也不能省略）
<ul><li>Host: 请求主机地址</li> <li>Content-length: 接下来主体信息长度</li> <li>Content-type: 主体数据格式</li> <li>key: value</li></ul></li> <li>请求主体信息（可选）</li></ul></div> <h4 id="响应信息"><a href="#响应信息" class="header-anchor">#</a> 响应信息</h4> <div class="custom-block tip"><ul><li>响应行
<ul><li>协议版本</li> <li>状态码
<ul><li>1XX：接收到请求，继续处理</li> <li>2XX：操作成功收到、理解和接收</li> <li>3XX：为了完成请求，必须采取进一步措施
<ul><li>301 ---- 永久重定向</li> <li>302 ---- 临时重定向 FOUND，响应头信息中会指定 <strong>Location: 重定向地址</strong> 信息</li> <li>304 ---- Not Modified 取浏览器缓存</li> <li>307 ---- 重定向中 <strong>保持原有的请求数据</strong>，针对 POST 等携带数据的请求方法</li></ul></li> <li>4XX：客户端错误</li> <li>5XX：服务端错误</li></ul></li> <li>状态文字（描述状态码文字，便于观察）</li></ul></li> <li>响应头信息
<ul><li>key: value</li> <li>content-length: 接下来主体信息的长度</li></ul></li> <li>响应主体信息</li></ul></div> <h2 id="http-进阶"><a href="#http-进阶" class="header-anchor">#</a> HTTP 进阶</h2> <h3 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h3> <div class="custom-block tip"><p>如果在自己的网页里引用站外图片时，经常会出现图片无法访问的错误，那它们是怎么识别到图片是站外被引用的呢，或者一些网站是怎么实现统计用户是从哪个网站跳转过来的呢。原理是一样的，根据请求头信息中的 <strong>Referer: 网页来源</strong>，即上一页的地址，如果是直接在浏览器上输入地址访问的，则没有 Referer 头信息。</p> <p>那么怎么实现图片防盗链呢，在 web 服务器层面，根据 http 协议的 referer 头信息来判断如果来自站外，则返回相应措施。</p></div> <h3 id="缓存详解"><a href="#缓存详解" class="header-anchor">#</a> 缓存详解</h3> <h4 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h4> <div class="custom-block tip"><p>我们观察图片的下载，往往第一次请求时，返回 200 OK，第二次请求时，返回 304 Not Modified。</p> <p><strong>原因：</strong> 在网络上，有一些缓存服务器，另外，浏览器自身也有缓存功能，当我们第一次访问某图片时，正常下载，返回值 200，基于一个前提--图片不会经常改动，服务器在返回 200 的同时，还返回该图片的 &quot;签名&quot; -- ETag，Last-Modified，当浏览器再次访问该图片时，携带该&quot;签名&quot; -- If-None-Match，If-Modified-Since 去服务器校验该&quot;签名&quot;，如果图片没有变化，返回304  通知浏览器直接使用缓存中的图片，这样减轻了服务器的负担。</p></div> <h4 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> 强制缓存</h4> <div class="custom-block tip"><p>在一些大型网站，有N太缓存服务器，那么这些服务器如何处理主服务器上的文件，要不要让浏览器缓存这些文件，缓存多久，HTTP 协议有几个字段来实现这个功能的。</p> <p><strong>cache-control：</strong> 告诉浏览器、缓存服务器以怎样的方式缓存资源</p> <ul><li>no-store -- 不缓存，每次都向源服务器发请求，一般是网站首页</li> <li>must-revalidate -- 告诉浏览器、缓存服务器，在本地资源副本过期前，可以使用本地副本，本地副本一旦过期，必须去源服务器进行有效性校验</li> <li>no-cache -- 告诉浏览器或缓存服务器不管本地缓存是否过期，在使用资源副本前，都应先去资源源服务器校验资源有效性</li> <li>max-age等</li></ul> <p><strong>expires：</strong> 资源过期时间，如果浏览器发现资源还在缓存有效期内，则不发起请求，减轻服务器压力</p></div> <h3 id="http-内容压缩"><a href="#http-内容压缩" class="header-anchor">#</a> HTTP 内容压缩</h3> <div class="custom-block tip"><p>在访问大型网站时，在它的请求响应头信息中，除了有 Content-length: value 信息，还会有一个 <strong>Content-Encoding: gzip</strong> 信息，此时 Content-length 的值和返回的主体长度不一致，原因在于为了提高网页在网络上的传输速度，服务器对主体信息进行了压缩，如常见的 gzip压缩、deflate压缩、compress压缩等，Content-length 为压缩后的长度。</p></div> <h3 id="http-cookie"><a href="#http-cookie" class="header-anchor">#</a> HTTP Cookie</h3> <div class="custom-block tip"><p>HTTP 请求是无状态的，即每次HTTP请求是独立的，服务器无法识别HTTP请求是哪个客户发起的，所以在对客户请求认证之后在响应头信息中通过 <strong>Set-cookie</strong> 字段标识客户，以后浏览器每次发起 HTTP 请求都必须在请求头信息中通过 <strong>Cookie</strong> 字段携带该信息给服务器识别。Cookie 也可能被盗，为安全起见现在都通过 <strong>图片验证码</strong>、<strong>手机验证码</strong> 来进行验证。</p> <p>Cookie 里一般会包含一下信息：</p> <table><thead><tr><th style="text-align:left;">属性项</th> <th style="text-align:left;">属性项介绍</th></tr></thead> <tbody><tr><td style="text-align:left;">NAME=VALUE</td> <td style="text-align:left;">键值对，可以设置要保存的 Key/Value，注意这里的 NAME 不能和其他属性项的名字一样</td></tr> <tr><td style="text-align:left;">Expires</td> <td style="text-align:left;">过期时间，在设置的某个时间点后该 Cookie 会失效</td></tr> <tr><td style="text-align:left;">maxAge</td> <td style="text-align:left;">设置 Cookie 有效时长，有3种值，正数：该 Cookie 会在 maxAge 秒后自动失效，浏览器会将maxAge为正数的 Cookie 持久化，无论是关闭浏览器还是电脑，只要在 maxAge 秒之前，登录网站时该 Cookie 仍然有效。负数：表示该 Cookie 只是一个临时 Cookie，不会被持久化，仅在本浏览器窗口或者本窗口打开的子窗口中有效，关闭浏览器后该 Cookie 立即失效。当 maxAge为 0 时，表示立即删除 Cookie</td></tr> <tr><td style="text-align:left;">Domain</td> <td style="text-align:left;">生成该 Cookie 的域名，如 domain='www.baidu.com'，正常情况下 Cookie 是只能在一个域名下使用，如果想在多个二级域名中使用同一个 Cookie，可以设置该值为 .baidu.com</td></tr> <tr><td style="text-align:left;">Path</td> <td style="text-align:left;">该 Cookie 是在当前的哪个路径下生成的，如 path=/wp-admin/</td></tr> <tr><td style="text-align:left;">Secure</td> <td style="text-align:left;">如果设置了这个属性，那么只会在 SSL 连接时才会回传该 Cookie</td></tr> <tr><td style="text-align:left;">HttpOnly</td> <td style="text-align:left;">Cookie 信息只读</td></tr></tbody></table></div> <h2 id="http-各版本特性"><a href="#http-各版本特性" class="header-anchor">#</a> HTTP 各版本特性</h2> <h3 id="http-0-9"><a href="#http-0-9" class="header-anchor">#</a> HTTP/0.9</h3> <div class="custom-block tip"><p>0.9不支持请求头，只支持GET方法</p></div> <h3 id="http-1-0"><a href="#http-1-0" class="header-anchor">#</a> HTTP/1.0</h3> <div class="custom-block tip"><ul><li>在请求中加入HTTP版本号</li> <li>HTTP开始有header</li> <li>增加了HTTP Status Code标识相关的状态码</li> <li>增加Content-type 可以传输其他文件</li> <li>缺陷：
<ul><li>每请求一个资源都要新建一个TCP链接，而且是串行请求</li></ul></li></ul></div> <h3 id="http-1-1"><a href="#http-1-1" class="header-anchor">#</a> HTTP/1.1</h3> <div class="custom-block tip"><ul><li>支持设置keepalive让HTTP重用TCP链接</li> <li>支持pipeline网络传输，第一个请求发出去，不必等其回来，就可以发第二个请求出去</li> <li>支持 Chunked Responses，也就是说，在 Response 的时候，不必说明 Content-Length ，这样，客户端就不能断连接，直到收到服务端的EOF标识。这种技术又叫 &quot;服务端push模型&quot;</li> <li>增加 cache control 机制</li> <li>协议头注增加 Language, Encoding, Type 等头，让客户端可以跟服务器端进行更多协商</li> <li>header中增加 HOST 头，让服务器知道请求的是哪个网站。因为可以有多个域名解析到同一个IP上</li> <li>加入 OPTIONS 方法，其主要用于 CORS - Cross Origin Resource Sharing 应用</li> <li>缺陷：
<ul><li>请求并行数量限制</li> <li>传输数据时，是以文本的方式，借助耗 CPU的zip压缩的方式减少网络带宽，但是耗了前端和后端的 CPU，传输数据的成本比较大</li></ul></li></ul></div> <h3 id="http-2-0"><a href="#http-2-0" class="header-anchor">#</a> HTTP/2.0</h3> <div class="custom-block tip"><ul><li>HTTP/2 是一个二进制协议，增加了数据传输的效率</li> <li>没有请求并发数量限制</li> <li>多路复用，HTTP2.0中，有两个概念非常重要：帧（frame）和流（stream），帧是最小的数据单位，每个帧会标识出该帧属于哪个流，流是多个帧组成的数据流。
所谓多路复用，即在一个TCP连接中存在多个流，即可以同时发送多个请求，对端可以通过帧中的表示知道该帧属于哪个请求。在客户端，这些帧乱序发送，到对端后再根据每个帧首部的流标识符重新组装。通过该技术，可以避免HTTP旧版本的队头阻塞问题，极大提高传输性能。</li> <li>压缩header，如果同时发出多个请求，他们的头是一样的或是相似的，那么，协议会帮你消除重复的部分</li> <li>允许服务端在客户端放cache，又叫服务端push，也就是说，没有请求的东西，服务端可以先发送到浏览器本地缓存</li> <li>缺陷：
<ul><li>协议复杂度提升，比如内部维护一个&quot;优先级树&quot;来做一些资源和请求的调度和控制，降低协议的可维护性和可扩展性的权衡</li> <li>若干个HTTP的请求在复用一个TCP的连接，底层的TCP协议是不知道上层有多少个HTTP请求的，所以一旦发生丢包，造成的问题就是所有的HTTP请求都必需等待这个丢了的包被重新传回来，哪怕丢的那个包不是我这个HTTP请求的 ---- Head-of-Line Blocking</li></ul></li></ul></div> <h3 id="http-3-0"><a href="#http-3-0" class="header-anchor">#</a> HTTP/3.0</h3> <div class="custom-block tip"><p>把HTTP底层的TCP协议改成UDP</p> <p><a href="/frontend">回首页</a></p></div> <p>（完）</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.73819cc8.js" defer></script><script src="/assets/js/2.1d157987.js" defer></script><script src="/assets/js/38.a7b0b0ff.js" defer></script>
  </body>
</html>
