(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{365:function(s,t,a){s.exports=a.p+"assets/img/csp-result1.32cf439a.jpg"},366:function(s,t,a){s.exports=a.p+"assets/img/csp-result2.7672f9c9.jpg"},367:function(s,t,a){s.exports=a.p+"assets/img/csp-result3.af673cd8.jpg"},428:function(s,t,a){"use strict";a.r(t);var n=a(41),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"xss-攻击及-csp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击及-csp"}},[s._v("#")]),s._v(" XSS 攻击及 CSP")]),s._v(" "),n("hr"),s._v(" "),n("p",[n("em",[s._v("2020/11/16")])]),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",[n("code",[s._v("XSS(跨站脚本攻击)")]),s._v(" 和 "),n("code",[s._v("CSRF(跨站请求伪造)")]),s._v(" 这两个是前端安全绕不开的话题，今天主要学习下 "),n("code",[s._v("XSS攻击")]),s._v(" 和 "),n("code",[s._v("CSP(内容安全策略)")]),s._v("。")])]),s._v(" "),n("h2",{attrs:{id:"什么是-xss"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-xss"}},[s._v("#")]),s._v(" 什么是 XSS")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",[n("strong",[s._v("XSS(跨站脚本攻击)：")]),s._v(" 攻击者通过在目标网站上注入恶意脚本，使之在用户浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息，如（Cookie、SessionID等），进而危害用户数据安全。")])]),s._v(" "),n("h2",{attrs:{id:"xss-攻击注入方式、分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击注入方式、分类"}},[s._v("#")]),s._v(" XSS 攻击注入方式、分类")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",[n("code",[s._v("XSS")]),s._v(" 一般有以下几种注入方式：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("在 "),n("code",[s._v("HTML")]),s._v(" 内嵌的文本中，恶意内容以 "),n("code",[s._v("script")]),s._v(" 标签形式注入")])]),s._v(" "),n("li",[n("p",[s._v("在内联的 "),n("code",[s._v("JavaScript")]),s._v(" 中，拼接的数据突破了原本的限制（字符串、变量、方法名等）")])]),s._v(" "),n("li",[n("p",[s._v("在标签的 href、src 等属性中，包含 javascript: 等可执行的代码")])]),s._v(" "),n("li",[n("p",[s._v("在 onload、onerror、onclick 等事件中，注入不受控制代码")]),s._v(" "),n("p",[s._v("根据 "),n("code",[s._v("XSS")]),s._v(" 的注入方式可以将 "),n("code",[s._v("XSS攻击")]),s._v(" 分为三类：")])])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[s._v("类型")]),s._v(" "),n("th",{staticStyle:{"text-align":"left"}},[s._v("存储区")]),s._v(" "),n("th",{staticStyle:{"text-align":"left"}},[s._v("插入点")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("存储型XSS")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("后端数据库")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("HTML")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("反射性XSS")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("URL")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("HTML")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("DOM型XSS")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("后端数据库/前端存储/URL")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("前端JavaScript")])])])])]),s._v(" "),n("h2",{attrs:{id:"xss-攻击常规预防措施"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击常规预防措施"}},[s._v("#")]),s._v(" XSS 攻击常规预防措施")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",[s._v("从 "),n("code",[s._v("XSS攻击")]),s._v(" 过程我们可以发现，它要成功的话需要同时满足两个要素：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("攻击者提交恶意代码")])]),s._v(" "),n("li",[n("p",[s._v("浏览器执行恶意代码")]),s._v(" "),n("p",[s._v("那我们阻断其中之一就可预防 "),n("code",[s._v("XSS攻击")]),s._v("，所以对应措施有：")])]),s._v(" "),n("li",[n("p",[s._v("输入过滤")])]),s._v(" "),n("li",[n("p",[s._v("改成纯前端渲染，把代码和数据分隔开")])]),s._v(" "),n("li",[n("p",[s._v("对 "),n("code",[s._v("HTML")]),s._v(" 做充分转义（特别是直接对DOM元素操作时）")])]),s._v(" "),n("li",[n("p",[s._v("设置 "),n("code",[s._v("Cookie")]),s._v(" 为 HTTP-only")])]),s._v(" "),n("li",[n("p",[s._v("验证码校验")]),s._v(" "),n("p",[s._v("上面这些都是常规的预防 "),n("code",[s._v("XSS攻击")]),s._v(" 的措施，除此之外，"),n("code",[s._v("HTML5")]),s._v(" 中新增了 "),n("code",[s._v("CSP")]),s._v(" 策略，从浏览器层面来处理 "),n("code",[s._v("XSS 攻击")]),s._v("，可以说是从根源上预防 "),n("code",[s._v("XSS攻击")]),s._v("(各大浏览器都已支持)。")])])])]),s._v(" "),n("h2",{attrs:{id:"csp-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#csp-是什么"}},[s._v("#")]),s._v(" CSP 是什么")]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",[n("strong",[s._v("CSP:")]),s._v(" 全称（Content-Security-Policy），是一个额外的安全层，用于检测并削弱某些特定类型的攻击，包括跨站脚本（XSS）和数据注入攻击等。")]),s._v(" "),n("p",[n("code",[s._v("CSP")]),s._v(" 的主要目标是减少和报告 "),n("code",[s._v("XSS攻击")]),s._v("，"),n("code",[s._v("XSS攻击")]),s._v(" 利用了浏览器对于从服务器所获取的内容的信任。恶意脚本在受害者的浏览器中得以运行，因为浏览器信任其内容来源，即使有的时候这些脚本并非来自它本该来的地方。")]),s._v(" "),n("p",[n("code",[s._v("CSP")]),s._v(" 通过指定有效域 ---- 即浏览器认可的可执行脚本的有效来源 ---- 使服务器管理者有能力减少或消除 "),n("code",[s._v("XSS攻击")]),s._v(" 所依赖的载体。一个 "),n("code",[s._v("CSP")]),s._v(" 兼容的浏览器仅执行从白名单获取到的脚本文件，忽略所有的其他脚本（包括内联脚本和HTML的事件处理属性）。")]),s._v(" "),n("p",[s._v("作为一种终极防护形式，始终不允许执行脚本的站点可以选择全面禁止脚本执行。")])]),s._v(" "),n("h2",{attrs:{id:"csp-简单使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#csp-简单使用"}},[s._v("#")]),s._v(" CSP 简单使用")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",[s._v("配置 "),n("code",[s._v("CSP")]),s._v(" 只需添加 "),n("code",[s._v("Content-Security-Policy")]),s._v(" 到 "),n("code",[s._v("HTTP")]),s._v(" 头部，并添加相应的值。一个例子说明：")]),s._v(" "),n("p",[s._v("为模仿跨域，本地启动两个 Node 服务，一个端口3000，一个端口3001，3000端口服务返回的 "),n("code",[s._v("HTML")]),s._v(" 文件中通过 "),n("code",[s._v("script")]),s._v(" 标签请求一个3001端口服务提供的js脚本，相关代码如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// server:3000 ->  index.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" express "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("express"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("static")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./public'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("服务启动成功： http://localhost:3000")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// server:3000 -> public/index.html")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCTYPE")]),s._v(" html"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html lang"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"en"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"viewport"')]),s._v(" content"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"width=device-width, initial-scale=1.0"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Document"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("title"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("head"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hello  world"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script src"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.js"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script src"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:3001/b.js"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("body"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//server:3000  -> public/a.js")]),s._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'我是 3000 端口的  a.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// server:3001 -> index.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" express "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("express"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("static")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./public'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("服务启动成功： http://localhost:3001")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// server:3001 -> public/b.js")]),s._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'我是 3001 端口的  b.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("启动两个服务，在浏览器向 3000端口发起请求，一切正常，如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(365),alt:"result1"}})]),s._v(" "),n("p",[s._v("这里 b.js 文件是外域的，可能不安全，3000服务器不想在客户的浏览器上执行它，简单，只需给 "),n("code",[s._v("HTTP")]),s._v(" 头配置 "),n("code",[s._v("Content-Security-Policy")]),s._v(" 属性即可，如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// server:3000  index.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" express "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Security-Policy'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("script-src 'self'")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("express"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("static")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./public'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("服务启动成功： http://localhost:3000")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("再启动两个服务，发起请求，结果如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(366),alt:"result2"}}),s._v(" "),n("img",{attrs:{src:a(367),alt:"result3"}})]),s._v(" "),n("p",[s._v("可以看到，b.js 文件资源的HTTP请求都没发起就直接被浏览器拦截掉了。")])]),s._v(" "),n("h2",{attrs:{id:"csp-属性值说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#csp-属性值说明"}},[s._v("#")]),s._v(" CSP 属性值说明")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",[s._v("一个 "),n("code",[s._v("Content-Security-Policy")]),s._v(" 头可以配置多个资源，中间用 "),n("strong",[s._v(";")]),s._v(" 分割，且策略中应该包含一个 "),n("code",[s._v("default-src")]),s._v(" 策略指令，在其他资源类型没有符合自己的策略时用该策略")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("Content"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Security"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Policy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("src "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'self'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("policy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("directive"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("policy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("directive"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("除了上面的 "),n("code",[s._v("script-src")]),s._v("，它还支持以下地址：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("connect-src ---- 限制能通过脚本接口加载的URL")])]),s._v(" "),n("li",[n("p",[s._v("default-src ---- 为其他取指令提供备用服务")])]),s._v(" "),n("li",[n("p",[s._v("font-src ---- 设置允许通过 "),n("code",[s._v("@font-face")]),s._v(" 加载的字体源地址")])]),s._v(" "),n("li",[n("p",[s._v("frame-src ---- 设置允许通过类似 <frame> 和 <iframe> 标签加载的内嵌内容的源地址")])]),s._v(" "),n("li",[n("p",[s._v("img-src ---- 限制图片和图标的源地址")])]),s._v(" "),n("li",[n("p",[s._v("style-src ---- 限制层叠样式表文件源")])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy",target:"_blank",rel:"noopener noreferrer"}},[s._v("其他"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("<source>可以是以下值之一：")])]),s._v(" "),n("li",[n("p",[s._v("'self' ---- 指向与要保护的文件所在的源")])]),s._v(" "),n("li",[n("p",[s._v("'unsafe-inline' ---- 允许使用内联资源，例如内联 <script> 元素(javascript:URL)")])]),s._v(" "),n("li",[n("p",[s._v("'unsafe-eval' ---- 允许使用 "),n("code",[s._v("eval()")]),s._v(" 以及相似的函数来从字符串创建代码")])]),s._v(" "),n("li",[n("p",[s._v("'none' ---- 不允许任何内容")])]),s._v(" "),n("li",[n("p",[s._v("'nonce-<base64值>' ---- 特定使用一次性加密内联脚本的白名单。")])]),s._v(" "),n("li",[n("p",[s._v("<hash-source> ---- 使用 sha256、sha384 或 sha512 编码过的内联脚本或样式")]),s._v(" "),n("p",[n("a",{attrs:{href:"/frontend"}},[s._v("回首页")])])])])]),s._v(" "),n("p",[s._v("（完）")])])}),[],!1,null,null,null);t.default=e.exports}}]);